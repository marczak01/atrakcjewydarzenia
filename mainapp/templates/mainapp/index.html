{% extends 'mainapp/base.html' %}
{% load static %}
{% load mainapp_tags %}
{% load i18n %}
{% block content %}
    <main class="home">
        <section class="home__welcome">
            <h3 class="home__welcome-h3">
                Witaj 
                <span class="home__welcome-username">
                    {{ request.user.username }}
                </span>
            </h3>
            <p class="paragraph">Znajdź atrakcje i wydarzenia dopasowane do twoich preferencji.</p>
        </section>
        <section class="home__banner">
            <div class="home__banner__box">
                <div class="home__banner__box-img">
                    <div class="home__banner__box-text">
                        <h2>Znizka 10%</h2>
                        <p>Uzyj kodu 'EVENTLY25' <br>aby zyskac 10% znizki na wszystko</p>
                    </div>
                    <img src="{% static 'images/dobrzyca.jpg' %}" alt="zdjecie banner">
                </div>
            </div>
        </section>
        <section class="home__search">
            <h3 class="heading-3">Znajdź ulubione wydarzenie</h3>
            <form action="{% url 'mainapp:events' %}" method="post">
                {% csrf_token %}
                <div class="home__search__fgroup">
                    <label class="home__search__fgroup-label" for="location">Lokalizacja</label>
                    <input class="home__search__fgroup-input" name="location_search" type="text" id="location" placeholder="np. Warszawa">
                </div>
                <div class="home__search__fgroup">
                    <label class="home__search__fgroup-label" for="weekday">Dzień tygodnia</label>
                    <select class="home__search__fgroup-input" name="weekday_search" id="weekday">
                        <option selected class="home__search__fgroup-option">Wybierz dzień</option>
                        <option class="home__search__fgroup-option" value="monday">Poniedziałek</option>
                        <option class="home__search__fgroup-option" value="tuesday">Wtorek</option>
                        <option class="home__search__fgroup-option" value="wednesday">Środa</option>
                        <option class="home__search__fgroup-option" value="thursday">Czwartek</option>
                        <option class="home__search__fgroup-option" value="friday">Piątek</option>
                        <option class="home__search__fgroup-option" value="saturday">Sobota</option>
                        <option class="home__search__fgroup-option" value="sunday">Niedziela</option>
                    </select>
                </div>
                <div class="home__search__fgroup">
                    <label class="home__search__fgroup-label" for="date">Data</label>
                    <input class="home__search__fgroup-input" name="date_search" type="date" id="date">
                </div>
                <button class="home__search-btn">Szukaj</button>
            </form>
        </section>
        <section class="home__promoted">
            {% for event in events %}
                <div class="event">
                    <a href="{{event.get_absolute_url }}">
                        <div class="event__img">
                            {% if event.event_photo %}
                                <img src="{{ event.event_photo.url }}" alt="">
                            {% else %}
                                <img src="{% static 'images/klub.jpg' %}" alt="">
                            {% endif %}
            
                            <span class="event-timeuntil">
                                {% no_days event.start_date.date|date:'z' time_now.date|date:'z' event.start_date.date|date:'Y' time_now.date|date:'Y' as days_dif %}
                                {% if days_dif < 0 %}
                                    {% absolute  days_dif %} dni temu
                                {% else %}
                                    za {{ days_dif }} dni
                                {% endif %}
                            </span>
                            {% language 'pl' %}
                                <a href="{% url 'account:dashboard' %}"><span class="event-monthday">{{ event.start_date.date|date:'l' }}</span></a>
                            {% endlanguage %}
                            <a href="{% url 'account:dashboard' %}"><span class="event-location">{{ event.city }}</span></a>
                            <a href="#"><span class="event-rating">{% count_rating_event event %} ({% count_ratings event %})</span></a>
                            {% if request.user.id %}
                                {% follow_or_unfollow event.id request.user as follow_unfollow %}
                                {% if follow_unfollow %}
                                    <a href="{% url 'mainapp:unfollow_event' pk=event.id page='home' %}">
                                        <span class="event-follow">
                                            <svg class="event-follow-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 21.35l-1.45-1.32C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg>
                                        </span>
                                    </a>
                                {% else %}
                                    <a href="{% url 'mainapp:follow_event' pk=event.id page='home' %}">
                                        <span class="event-follow">
                                            <svg class="event-follow-svg-flw" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 21.35l-1.45-1.32C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg>
                                        </span>
                                    </a>
                                {% endif %}
                            {% else %}
                                <a href="{% url 'account:login' %}">
                                    <span class="event-follow event-follow-disabled">
                                        <svg class="event-follow-svg-disabled" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="m12 21.35l-1.45-1.32C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z"/></svg>
                                    </span>
                                </a>
                            {% endif %}
                        </div>
                    </a>
                    <div class="event__bottom">
                        <p class="event-title">{{ event.name }}</p>
                        <span class="event-date">{{ event.start_date|date:'d.m.Y H:i' }} - {{event.end_date|date:'d.m.Y H:i'}}</span>
                        <p class="event__description">
                            {{ event.description|truncatewords_html:20 }}
                        </p>
                    </div>
                    <div class="event__tags">
                        {% for tag in event.tags.all|slice:':4' %}
                            <a class="event__tags-tag" href="{% url 'mainapp:events_by_tag' tag.slug %}">#{{ tag.name }}</a>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </section>
        <section class="home__selected">
            <div class="home__selected__options">
                <span class="home__selected__options__option">
                    <a class="home__selected__options__option-link" href="#">Most Popular</a>
                </span>
                <span class="home__selected__options__option">
                    <a class="home__selected__options__option-link" href="#">Special Offers</a>
                </span>
                <span class="home__selected__options__option">
                    <a class="home__selected__options__option-link" href="#">Near Me</a>
                </span>
            </div>
            <div class="home__selected__events">
                {% for event in events %}
                    <div class="home__selected__events__event">
                        <div class="home__selected__events__event__img">
                            <img src="{{ event.event_photo.url }}" alt="zdjecie wydarzenia">
                        </div>
                        <div class="home__selected__events__event__right">
                            <h4 class="home__selected__events__event-h4">{{ event.name }}</h4>
                            <p class="home__selected__events__event__right-date">{{ event.start_date|date:'d.m.Y' }} - {{event.end_date|date:'d.m.Y'}}</p>
                            {% language 'pl' %}
                                <span class="home__selected__events__event__right-monthday"><a href="{% url 'account:dashboard' %}">{{ event.start_date.date|date:'l' }}</a></span>
                            {% endlanguage %}
                            <span class="home__selected__events__event__right-timeuntil">
                                {% no_days event.start_date.date|date:'z' time_now.date|date:'z' event.start_date.date|date:'Y' time_now.date|date:'Y' as days_dif %}
                                {% if days_dif < 0 %}
                                    {% absolute  days_dif %} dni temu
                                {% else %}
                                    za {{ days_dif }} dni
                                {% endif %}
                            </span>
                            <span class="home__selected__events__event__right-rating"><a href="#">{% count_rating_event event %} ({% count_ratings event %})</a></span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>
    </main>
    <!-- <main class="home">
        <section class="home__banner">
            <div class="home__banner__img">
                <img class="home__banner__img-active" src="{% static 'images/dobrzyca.jpg' %}" alt="">
                <img src="{% static 'images/warsaw.jpg' %}" alt="">
            </div>
            <div class="home__search">
                <form method="post" action="{% url 'mainapp:events' %} " class="home__search__form">
                    {% csrf_token %}
                    <div class="home__search-options">
                        <div class="home__search__options">
                            <input hidden type="radio" value="events" name="events-attractions" id="events">
                            <input hidden type="radio" value="attractions" name="events-attractions" id="attractions">
                            <a href=""><label for="events" class="home__search__options-option">Eventy</label></a>
                            <a href=""><label for="attractions" class="home__search__options-option">Atrakcje</label></a>
                        </div>
                    </div>
                    <div class="home__search-form">
                    <div class="home__search__el">
                        <div class="home__search__el-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><circle cx="12" cy="10" r="3"/><path d="M12 2a8 8 0 0 0-8 8c0 1.892.402 3.13 1.5 4.5L12 22l6.5-7.5c1.098-1.37 1.5-2.608 1.5-4.5a8 8 0 0 0-8-8"/></g></svg>
                        </div>
                        <input class="home__search-input" type="text" name="location_search" placeholder="Miejsce">
                    </div>
                    <div class="home__search__el">
                        <div class="home__search__el-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" d="M5.673 0a.7.7 0 0 1 .7.7v1.309h7.517v-1.3a.7.7 0 0 1 1.4 0v1.3H18a2 2 0 0 1 2 1.999v13.993A2 2 0 0 1 18 20H2a2 2 0 0 1-2-1.999V4.008a2 2 0 0 1 2-1.999h2.973V.699a.7.7 0 0 1 .7-.699M1.4 7.742v10.259a.6.6 0 0 0 .6.6h16a.6.6 0 0 0 .6-.6V7.756zm5.267 6.877v1.666H5v-1.666zm4.166 0v1.666H9.167v-1.666zm4.167 0v1.666h-1.667v-1.666zm-8.333-3.977v1.666H5v-1.666zm4.166 0v1.666H9.167v-1.666zm4.167 0v1.666h-1.667v-1.666zM4.973 3.408H2a.6.6 0 0 0-.6.6v2.335l17.2.014V4.008a.6.6 0 0 0-.6-.6h-2.71v.929a.7.7 0 0 1-1.4 0v-.929H6.373v.92a.7.7 0 0 1-1.4 0z"/></svg>
                        </div>
                        <input class="home__search-input" type="text" name="weekday_search" placeholder="Środa, Czwartek..">
                    </div>
                    <div class="home__search__el">
                        <div class="home__search__el-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="currentColor" d="M5.673 0a.7.7 0 0 1 .7.7v1.309h7.517v-1.3a.7.7 0 0 1 1.4 0v1.3H18a2 2 0 0 1 2 1.999v13.993A2 2 0 0 1 18 20H2a2 2 0 0 1-2-1.999V4.008a2 2 0 0 1 2-1.999h2.973V.699a.7.7 0 0 1 .7-.699M1.4 7.742v10.259a.6.6 0 0 0 .6.6h16a.6.6 0 0 0 .6-.6V7.756zm5.267 6.877v1.666H5v-1.666zm4.166 0v1.666H9.167v-1.666zm4.167 0v1.666h-1.667v-1.666zm-8.333-3.977v1.666H5v-1.666zm4.166 0v1.666H9.167v-1.666zm4.167 0v1.666h-1.667v-1.666zM4.973 3.408H2a.6.6 0 0 0-.6.6v2.335l17.2.014V4.008a.6.6 0 0 0-.6-.6h-2.71v.929a.7.7 0 0 1-1.4 0v-.929H6.373v.92a.7.7 0 0 1-1.4 0z"/></svg>
                        </div>
                        <input class="home__search-input" name="date_search" type="date">
                    </div>
                    <div class="home__search__el">
                        <input class="home__search-btn" type="submit" value="SZUKAJ">
                    </div>
                </div>
                </form>
            </div>
        </section>
        <section class="home__promoted">
            <h3 class="h3">
                Promowane Eventy
            </h3>
            <div class="events">
                {% for event in events %}
                    <div class="events__event events__event-active ">
                        <a href="{{event.get_absolute_url }}">
                            <div class="events__event__top">
                                <p class="events__event__top__title">{{ event.name }}</p>
                                    <span class="events__event__top__date">{{ event.start_date|date:'d.m.Y H:i' }} - {{event.end_date|date:'d.m.Y H:i'}}</span>
                            </div>
                            <div class="events__event__img">
                                {% if event.event_photo %}
                                    <img src="{{ event.event_photo.url }}" alt="">
                                {% else %}
                                    <img src="{% static 'images/klub.jpg' %}" alt="">
                                {% endif %}
                
                                <span class="events__event__timeuntil">
                                    {% no_days event.start_date.date|date:'z' time_now.date|date:'z' event.start_date.date|date:'Y' time_now.date|date:'Y' as days_dif %}
                                    {% if days_dif < 0 %}
                                        {% absolute  days_dif %} dni temu
                                    {% else %}
                                        za {{ days_dif }} dni
                                    {% endif %}
                                </span>
                                {% language 'pl' %}
                                    <a href="{% url 'account:dashboard' %}"><span class="events__event__monthday">{{ event.start_date.date|date:'l' }}</span></a>
                                {% endlanguage %}
                                <a href="{% url 'account:dashboard' %}"><span class="events__event__location">{{ event.city }}</span></a>
                                <a href="#"><span class="events__event__rating">{% count_rating_event event %} ({% count_ratings event %})</span></a>
                                {% if request.user.id %}

                                {% follow_or_unfollow event.id request.user as follow_unfollow %}
                                {% if follow_unfollow %}
                                    <a href="{% url 'mainapp:unfollow_event' pk=event.id page='events' %}">
                                        <span class="events__event__follow">NIE OBSERWUJ</span>
                                    </a>
                                {% else %}
                                    <a href="{% url 'mainapp:follow_event' pk=event.id page='events' %}">
                                        <span class="events__event__follow">OBSERWUJ</span>
                                    </a>
                                {% endif %}
                                {% else %}
                                    <a href="{% url 'account:login' %}">
                                        <span style="background-color: rgb(125, 125, 125);" class="events__event__follow">obserwuj</span>
                                    </a>
                                {% endif %}
                
                            </div>
                            <p class="events__event__description">
                                {{ event.description|truncatewords_html:30 }}
                            </p>
                        </a>
                        <div class="events__event__tags">
                            {% for tag in event.tags.all|slice:':4' %}
                                <a href="{% url 'mainapp:events_by_tag' tag.slug %}">{{ tag.name }}</a>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>
        <section class="home__topDestinations">
            <h3 class="h3">
                Najczęściej odwiedzane
            </h3>
            <div class="home__topDestinations__boxes">
                {% for top_destination in top_destinations %}
                    <a href="{% url 'mainapp:events_by_city' city=top_destination.city %}">
                        <div class="home__topDestinations__boxes__topDestination">
                            <p>{{ top_destination.city }} ({{ top_destination.destination_count }})</p>
                        </div>
                    </a>
                {% endfor %}
            </div>
        </section>
    </main> -->
{% endblock content %}